# Description: A middleware layer between C libraries (using GObject) and language bindings.
# URL: https://live.gnome.org/GObjectIntrospection
# Maintainer: Danny Rawlins, crux at romster dot me
# Depends on: glib
# Optional: cairo

name=gobject-introspection
version=1.70.0
release=1
source=(https://download.gnome.org/sources/$name/${version::4}/$name-$version.tar.xz
gobject-introspection-1.70.0-build_fix-1.patch)


build() {
	prt-get isinst cairo || PKGMK_GOBJECTINTROSPECTION+=' -D cairo=disabled'

	cd $name-$version
	patch -Np1 -i $SRC/gobject-introspection-1.70.0-build_fix-1.patch
	cd ..
	meson build $name-$version $PKGMK_GOBJECTINTROSPECTION \
		--prefix /usr \
		--wrap-mode nodownload \
		-D b_lto=true \
		-D b_pie=true \
		-D doctool=disabled

	ninja -C build -j ${JOBS:-1}
	DESTDIR=$PKG meson install -C build

	/usr/bin/python3 -m compileall -d /usr/lib/$name $PKG
	/usr/bin/python3 -O -m compileall -d /usr/lib/$name $PKG
	/usr/bin/python3 -OO -m compileall -d /usr/lib/$name $PKG
}
